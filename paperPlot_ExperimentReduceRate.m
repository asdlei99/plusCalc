% 绘制论文用图
close all;

%原始的0m间距实验数据
raw0 = [...
5,7,8,9,11,12,16,17,19,20,22,23.5,25,26,28;...
8.127,5.80325,6.27525,4.61225,3.02775,2.63225,2.69875,3.9385,3.37575,3.30875,3.19475,2.55575,2.358666667,2.079,1.0265 ...
];
theory0 = [...
0.128931101914560,0.0880247031957137,0.0538451897466588,0.0240144811342499,-0.00315272323046910,-0.0288594947290090,-0.0538667708486752,-0.0781411264135839,-0.0991880608843795,-0.104889314783771,-0.0414741242526725,0.279132166603834,0.859006477929910,0.559705577581277,0.682869663672858,0.682869663672859,0.682869663672859,0.682869663672859,0.682869663672859,0.682869663672859,0.682869663672859,0.682869663672858,0.682869663672859,0.682869663672859,0.682869663672859,0.682869663672858,0.682869663672860,0];
theory0X = [0:13,(0:13) + 13 + 2+0.115*4];

% 0.5m间距
%6.7405,6.761,6.11325,5.941,5.2735,3.49975,2.84,3.0325,3.34175,3.18525,3.8035,3.65,3.48875,2.62275,2.57
raw05 = [...
5,7,8,9,11,12,16.5,17.5,19.5,20.5,22.5,24,26.5;...
6.9405,6.761,6.11325,5.541,4.6735,3.49975,2.889,3.18525,3.8035,3.65,3.48875,2.92275,2.17 ...
];
theory05 = [...
0.0880785280059870,0.0498503980934755,0.0198300107232198,-0.00470067277430524,-0.0254869773481135,-0.0435837143086724,-0.0594341623278339,-0.0726088186542911,-0.0806695863499328,-0.0750043830017270,-0.0243969299015221,0.184598864039740,0.721905749419565,0.590007318766930,0.634449255513137,0.634449255513137,0.634449255513136,0.634449255513137,0.634449255513136,0.634449255513136,0.634449255513137,0.634449255513136,0.634449255513135,0.634449255513136,0.634449255513135,0.634449255513136,0.634449255513133,0];
theory05X = [0:13,(0:13) + 13 + 2+0.115*4+0.5];
%1m间距
%6.05,6.4196,5.5046,4.7338,3.357,3.1278,2.4942,3.6512,3.4042,3.948,4.1894,4.1658,3.6354,3.1374,3.5212
raw1 = [...
5,7,8,9,11,12,17,18,20,21,23,24.5,26;...
6.605,6.4196,5.5046,4.7338,3.357,3.1278,3.4042,3.948,4.1894,4.1658,3.6354,3.1374,2.5212 ...
];
theory1 = [...
0.0660463314161922,0.0291813807071626,0.00170223626050726,-0.0194939085261569,-0.0363065153085501,-0.0497983349518322,-0.0603359550465253,-0.0674191104482835,-0.0688569375257327,-0.0579797419109252,-0.0136574713455728,0.136495255832387,0.566378258166603,0.656311862145726,0.589889984963206,0.589889984963206,0.589889984963206,0.589889984963206,0.589889984963206,0.589889984963206,0.589889984963206,0.589889984963205,0.589889984963205,0.589889984963205,0.589889984963204,0.589889984963205,0.589889984963203,0];
theory1X = [0:13,(0:13) + 13 + 2+0.115*4+1];
% 直管
rawStraight = [...
    7:28 ;...
    8.424323798,8.086675176,7.366043267,6.566389551,5.890767701,5.462666823,5.341473771,5.533709769,6.002112895,6.674540052,7.454202313,8.231869744,8.899693563,9.365352983,9.564541664,9.469550061,9.091904302,8.477665747,7.69491878,6.814012228,5.882026358,4.893503814 ...
];
theoryStraight = [...
    9.847895188,10.60828429,11.12495889,11.35585355,11.2782133,10.88600787,10.18868347,9.210901317,7.99375816,6.599750504,5.129366997,3.776796608,2.974513524,3.26031804,4.386673285,5.782089254,7.156853687,8.376456656,9.363791807,10.06864049,10.45825744,10.51420951,10.23114337,9.616077039,8.687705096,7.475521187,6.018688377,4.3646469,2.567480584,0.686082276 ...
];
% 直管拟合
ft = fittype( ['fourier','3'] );%3阶傅里叶拟合
fopts = fitoptions( ft );
[fitresultStraight, gof] = fit( rawStraight(1,:)',rawStraight(2,:)', ft, fopts );

%% 计算参数
X = raw0(1,:);
Y = raw0(2,:);
[fitresult0, gof] = fit( X',Y', ft, fopts );
xFit0 = raw0(1,1):0.5:raw0(1,end);
yFit0 = feval(fitresult0,xFit0);
yFitStraight0 = feval(fitresultStraight,xFit0);
reduceRate0 = ( yFitStraight0 - yFit0 )./yFitStraight0;

X = raw05(1,:)-1;
Y = raw05(2,:);
ft = fittype( ['fourier','3'] );%3阶傅里叶拟合
fopts = fitoptions( ft );
[fitresult05, gof] = fit( X',Y', ft, fopts );
xFit05 = X(1):0.5:X(end);
yFit05 = feval(fitresult05,xFit05);
yFitStraight05 = feval(fitresultStraight,xFit05);
reduceRate05 = ( yFitStraight05 - yFit05 )./yFitStraight05;

X = raw1(1,:);
Y = raw1(2,:);
ft = fittype( ['fourier','3'] );%3阶傅里叶拟合
fopts = fitoptions( ft );
[fitresult, gof] = fit( X',Y', ft, fopts );
xFit1 = raw1(1,1):0.5:raw1(1,end);
yFit1 = feval(fitresult,xFit1);
yFitStraight1 = feval(fitresultStraight,xFit1);
reduceRate1 = ( yFitStraight1 - yFit1 )./yFitStraight1;


figure
h = [];
hold on;
h(1) = plot(xFit0(1:2:end),reduceRate0(1:2:end).*100,'-.o','color',[240,57,57]./255);
h(2) = plot(xFit05(1:2:end),reduceRate05(1:2:end).*100,'--^','color',[116,33,240]./255);
h(3) = plot(xFit1(1:2:end),reduceRate1(1:2:end).*100,'-s','color',[44,162,70]./255);

h(4) = plot(theory0X,theory0.*100,'-.','color',[240,57,57]./255);
h(5) = plot(theory05X,theory05.*100,'--','color',[116,33,240]./255);
h(6) = plot(theory1X,theory1.*100,'-','color',[44,162,70]./255);
set(gcf,'color','w');
grid on;
legend(h,{'实验0m间距','实验0.5m间距','实验1m间距','理论0m间距','理论0.5m间距','理论1m间距'},0);
xlabel('距离(m)');
ylabel('脉动抑制率(%)');
title('实验数据脉动抑制率结果对比');

